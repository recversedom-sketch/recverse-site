---
const { user, domain, text, subject, class: klass } = Astro.props;

// einfache “Obfuskation”: Strings reversed im HTML, im Browser wieder zusammensetzen
const userR = String(user).split("").reverse().join("");
const domainR = String(domain).split("").reverse().join("");
const label = text ?? `${user} [at] ${domain.replace(".", " [dot] ")}`;
const subj = subject ?? "";
const id = `email_${Math.random().toString(36).slice(2)}`;
const cls = klass ?? "underline hover:text-zinc-100";
---

<a id={id} href="#" rel="nofollow noreferrer" class={cls}>{label}</a>

<script is:inline>
(() => {
  const el = document.getElementById("{id}");
  if (!el) return;

  const userR = "{userR}";
  const domainR = "{domainR}";
  const subject = "{subj}";

  const user = userR.split("").reverse().join("");
  const domain = domainR.split("").reverse().join("");
  const email = `${user}@${domain}`;

  const href = `mailto:${email}` + (subject ? `?subject=${encodeURIComponent(subject)}` : "");
  el.setAttribute("href", href);
  el.setAttribute("aria-label", email);
  el.setAttribute("title", email);
})();
</script>
