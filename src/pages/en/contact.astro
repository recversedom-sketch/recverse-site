---
import BaseLayout from "../../layouts/BaseLayout.astro";

const sp = Astro.url.searchParams;
const preTopic = sp.get("topic") ?? "";
const preModule = sp.get("module") ?? "";
const prePackage = sp.get("package") ?? "";

const prefill =
  prePackage ? `Package: ${prePackage}\n` :
  preModule ? `Module: ${preModule}\n` :
  preTopic ? `Topic: ${preTopic}\n` : "";
---

<BaseLayout
  title="Brainstorm / Inquiry — Recverse"
  description="Briefly describe your goal. You’ll get a concrete response (scope, next steps)."
>
  <section class="section">
    <div class="container" style="max-width: 760px;">
      <div class="kicker">Contact</div>
      <h1 class="h1">Send an inquiry</h1>
      <p class="p">
        Briefly describe what you want to achieve. I’ll get back to you as soon as possible.
      </p>

      <form
        name="angebot"
        method="POST"
        action="/en/thanks/"
        data-netlify="true"
        data-netlify-honeypot="bot-field"
        class="card"
        style="margin-top:18px; padding:18px;"
      >
        <input type="hidden" name="form-name" value="angebot" />

        <!-- Honeypot -->
        <p style="position:absolute; left:-9999px; height:0; overflow:hidden;">
          <label>Don’t fill this out: <input name="bot-field" tabindex="-1" autocomplete="off" /></label>
        </p>

        <!-- Time-trap + JS-gate -->
        <input type="hidden" name="tt_start" value="0" />
        <input type="hidden" name="js_ok" value="0" />

        <div class="grid grid-2">
          <label style="display:grid; gap:8px;">
            <span class="muted">Name (required)</span>
            <input name="name" required class="card" style="padding:12px; background:rgba(0,0,0,.15);" />
          </label>

          <label style="display:grid; gap:8px;">
            <span class="muted">Email (required)</span>
            <input name="email" type="email" required class="card" style="padding:12px; background:rgba(0,0,0,.15);" />
          </label>
        </div>

        <div class="grid grid-2" style="margin-top:12px;">
          <label style="display:grid; gap:8px;">
            <span class="muted">Company (optional)</span>
            <input name="company" class="card" style="padding:12px; background:rgba(0,0,0,.15);" />
          </label>

          <label style="display:grid; gap:8px;">
            <span class="muted">Phone (optional, for a callback)</span>
            <input name="phone" class="card" style="padding:12px; background:rgba(0,0,0,.15);" />
          </label>
        </div>

        <label style="display:grid; gap:8px; margin-top:12px;">
          <span class="muted">What is this about?</span>
          <select name="topic" class="card" style="padding:12px; background:rgba(0,0,0,.15);">
            {[
              "Brainstorming",
              "AI MVP / PoC",
              "ERP / IT Project Management",
              "Web Presence / Redesign",
              "Website Privacy Check",
              "Website Renewal / SEO",
              "Something else",
            ].map((opt) => (
              <option value={opt} selected={preTopic === opt}>{opt}</option>
            ))}
          </select>
        </label>

        <label style="display:grid; gap:8px; margin-top:12px;">
          <span class="muted">Short description (required)</span>
          <textarea
            name="message"
            required
            rows="7"
            class="card"
            style="padding:12px; background:rgba(0,0,0,.15);"
          >{prefill}</textarea>
        </label>

        <div class="grid grid-2" style="margin-top:12px;">
          <label style="display:grid; gap:8px;">
            <span class="muted">Budget range (optional)</span>
            <select name="budget" class="card" style="padding:12px; background:rgba(0,0,0,.15);">
              <option value="">—</option>
              <option>under CHF 500</option>
              <option>CHF 500–1,500</option>
              <option>CHF 1,500–5,000</option>
              <option>CHF 5,000+</option>
              <option>open</option>
            </select>
          </label>

          <label style="display:grid; gap:8px;">
            <span class="muted">Timeline for the target outcome (optional)</span>
            <select name="timeline" class="card" style="padding:12px; background:rgba(0,0,0,.15);">
              <option value="">—</option>
              <option>ASAP / this week</option>
              <option>2–4 weeks</option>
              <option>1–3 months</option>
              <option>later</option>
            </select>
          </label>
        </div>

        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:14px;">
          <button type="submit" class="btn btn-primary">Send inquiry</button>
          <a class="btn btn-secondary" href="/en/services/">View services</a>
        </div>

        <p class="muted" style="font-size:12px; margin-top:10px;">
          By submitting, you agree that your information may be processed to handle your inquiry.
          Details: <a class="muted" style="text-decoration:underline;" href="/en/privacy/">Privacy</a>.
        </p>
      </form>

      <noscript>
        <div class="card" style="padding:14px; margin-top:14px;">
          <strong>Note:</strong>
          <div class="muted" style="margin-top:6px;">
            JavaScript is disabled. The form may still work, but anti-spam protection is reduced.
          </div>
        </div>
      </noscript>
    </div>
  </section>

  <script is:inline>
    // Time-trap + JS gate: simple, effective against low-effort bots.
    const form = document.querySelector('form[name="angebot"]');
    if (form) {
      const start = Date.now();
      const tt = form.querySelector('input[name="tt_start"]');
      const jsok = form.querySelector('input[name="js_ok"]');
      if (tt) tt.value = String(start);
      if (jsok) jsok.value = "1";

      form.addEventListener("submit", (e) => {
        const elapsed = Date.now() - start;
        // 3s minimum
        if (elapsed < 3000) {
          e.preventDefault();
          alert("Please take a moment to review, then submit (anti-spam).");
          return;
        }
        if (jsok && jsok.value !== "1") {
          e.preventDefault();
          alert("Please try again.");
          return;
        }
      });
    }
  </script>
</BaseLayout>
