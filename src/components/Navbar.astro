---
const nav = [
  { href: "/", label: "Start" },
  { href: "/services", label: "Leistungen" },
  { href: "/shop", label: "RecVerseShop" },
  { href: "/contact", label: "Kontakt" },
];

const path = Astro.url.pathname;
const isActive = (href) => (href === "/" ? path === "/" : path.startsWith(href));
---

<header class="nav">
  <div class="container nav__inner">
    <a class="brand" href="/" aria-label="Recverse Startseite">
      <span class="brand__mark" aria-hidden="true"></span>
      <span class="brand__name">Recverse</span>
    </a>

    <nav class="nav__links" aria-label="Hauptnavigation">
      {nav.map((item) => (
        <a href={item.href} aria-current={isActive(item.href) ? "page" : undefined}>
          {item.label}
        </a>
      ))}
    </nav>

    <div class="nav__cta">
      <a class="btn btn--primary" href="/contact">Brainstorming starten</a>
    </div>

    <button
      class="hamburger"
      type="button"
      aria-label="MenÃ¼"
      aria-expanded="false"
      aria-controls="mobileNav"
      data-nav-toggle
    >
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" />
      </svg>
    </button>
  </div>

  <div class="mobile" id="mobileNav" data-nav-panel>
    <div class="container mobile__inner">
      {nav.map((item) => (
        <a href={item.href} aria-current={isActive(item.href) ? "page" : undefined}>
          {item.label}
        </a>
      ))}

      <div class="mobile__cta">
        <a class="btn btn--primary" href="/contact">Brainstorming starten</a>
      </div>
    </div>
  </div>

  <script is:inline>
    (() => {
      const btn = document.querySelector("[data-nav-toggle]");
      const panel = document.querySelector("[data-nav-panel]");
      if (!btn || !panel) return;

      const setOpen = (open) => {
        panel.classList.toggle("mobile--open", open);
        btn.setAttribute("aria-expanded", String(open));
      };

      btn.addEventListener("click", () => setOpen(!panel.classList.contains("mobile--open")));

      // Close on navigation click
      panel.querySelectorAll("a").forEach((a) =>
        a.addEventListener("click", () => setOpen(false))
      );

      // Close on ESC
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") setOpen(false);
      });
    })();
  </script>
</header>
