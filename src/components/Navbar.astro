---
const nav = [
  { href: "/", label: "Start" },
  { href: "/services", label: "Leistungen" },
  { href: "/shop", label: "RecVerseShop" },
  { href: "/contact", label: "Kontakt" },
];

const path = Astro.url.pathname;

const isActive = (href) => {
  if (href === "/") return path === "/";
  return path === href || path.startsWith(href + "/");
};
---

<style>
  .nav {
    position: sticky;
    top: 0;
    z-index: 60;
    backdrop-filter: blur(14px);
    background: rgba(5, 7, 12, 0.65);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }
  .row {
    height: 72px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 14px;
  }
  .brand {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
    letter-spacing: -0.02em;
    font-family: "Space Grotesk", Inter, system-ui;
    color: rgba(255, 255, 255, 0.92);
    text-decoration: none;
  }
  .mark {
    width: 34px;
    height: 34px;
    border-radius: 12px;
    border: 1px solid rgba(0, 185, 255, 0.35);
    background: radial-gradient(
      120% 160% at 30% 15%,
      rgba(0, 185, 255, 0.35),
      rgba(0, 119, 255, 0.18) 55%,
      rgba(255, 255, 255, 0.04)
    );
    box-shadow: 0 18px 60px rgba(0, 185, 255, 0.12);
  }

  .links {
    display: flex;
    align-items: center;
    gap: 18px;
    padding: 8px 10px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.02);
  }
  .links a {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.72);
    text-decoration: none;
    padding: 7px 10px;
    border-radius: 999px;
    transition: transform 180ms ease, background 180ms ease, color 180ms ease;
    white-space: nowrap;
  }
  .links a:hover {
    color: rgba(255, 255, 255, 0.92);
    background: rgba(255, 255, 255, 0.05);
  }
  .links a[aria-current="page"] {
    color: rgba(255, 255, 255, 0.94);
    background: rgba(0, 185, 255, 0.10);
    box-shadow: 0 0 0 1px rgba(0, 185, 255, 0.14) inset;
  }

  .right {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .burger {
    display: none;
    width: 42px;
    height: 42px;
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.10);
    background: rgba(255, 255, 255, 0.03);
    color: rgba(255, 255, 255, 0.9);
    align-items: center;
    justify-content: center;
  }
  .burger:focus-visible {
    outline: none;
    box-shadow: var(--ring);
  }

  .mobile {
    display: none;
    padding: 10px 0 16px 0;
  }
  .mobile .panel {
    border: 1px solid rgba(255, 255, 255, 0.10);
    background: rgba(10, 14, 24, 0.55);
    border-radius: 22px;
    padding: 12px;
  }
  .mobile a {
    display: flex;
    align-items: center;
    justify-content: space-between;
    text-decoration: none;
    color: rgba(255, 255, 255, 0.86);
    padding: 12px 12px;
    border-radius: 14px;
  }
  .mobile a:hover {
    background: rgba(255, 255, 255, 0.05);
  }
  .mobile .cta {
    margin-top: 10px;
  }

  @media (max-width: 860px) {
    .links { display: none; }
    .burger { display: inline-flex; }
    .mobile { display: block; }
  }
</style>

<nav class="nav">
  <div class="container">
    <div class="row">
      <a class="brand" href="/" aria-label="Recverse Startseite">
        <span class="mark" aria-hidden="true"></span>
        <span>Recverse</span>
      </a>

      <div class="links" aria-label="Navigation">
        {nav.map((item) => (
          <a href={item.href} aria-current={isActive(item.href) ? "page" : undefined}>
            {item.label}
          </a>
        ))}
      </div>

      <div class="right">
        <a class="btn btn-primary" href="/contact">Brainstorming starten</a>

        <button
          class="burger"
          type="button"
          aria-label="Menü"
          aria-expanded="false"
          data-menu-btn
        >
          ☰
        </button>
      </div>
    </div>

    <div class="mobile" data-menu style="display:none;">
      <div class="panel">
        {nav.map((item) => (
          <a href={item.href} aria-current={isActive(item.href) ? "page" : undefined}>
            <span>{item.label}</span>
            <span aria-hidden="true">›</span>
          </a>
        ))}
        <div class="cta">
          <a class="btn btn-primary" style="width:100%; justify-content:center;" href="/contact">Brainstorming starten</a>
        </div>
      </div>
    </div>
  </div>
</nav>

<script is:inline>
  const btn = document.querySelector("[data-menu-btn]");
  const menu = document.querySelector("[data-menu]");
  if (btn && menu) {
    const close = () => {
      menu.style.display = "none";
      btn.setAttribute("aria-expanded", "false");
    };
    const open = () => {
      menu.style.display = "block";
      btn.setAttribute("aria-expanded", "true");
    };
    btn.addEventListener("click", () => {
      const expanded = btn.getAttribute("aria-expanded") === "true";
      expanded ? close() : open();
    });

    // Close on link click (mobile)
    menu.addEventListener("click", (e) => {
      const a = e.target.closest("a");
      if (a) close();
    });

    // Close on Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") close();
    });
  }
</script>
