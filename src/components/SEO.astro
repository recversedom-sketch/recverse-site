---
import { buildCanonical, buildAlternate, absUrl, type SeoProps, buildBreadcrumbJsonLd, buildOrgJsonLd } from "../lib/seo";

const props = Astro.props as SeoProps;

const SITE = "https://www.recverse.ch";

const title =
  props.title ?? "Recverse — KI & IT Delivery für KMUs";
const description =
  props.description ??
  "KI-MVPs, IT-Projektmanagement und moderne Web-Präsenzen für KMUs. Schlank umgesetzt, sauber betrieben.";

const pathname = Astro.url?.pathname ?? "/";
const canonical = buildCanonical(SITE, pathname);

const alternates = buildAlternate(SITE, pathname); // { deCH, en, xDefault }
const ogImage = absUrl(SITE, props.image ?? "/og/recverse-default.jpg");

const noindex = Boolean(props.noindex);

const breadcrumbJsonLd = buildBreadcrumbJsonLd(SITE, pathname);
const orgJsonLd = buildOrgJsonLd(SITE, props.structuredData);

// Optional: für Blog-Artikel (derzeit nicht genutzt)
const publishedTime = props.publishedTime;
---

<!-- Primary SEO -->
<title>{title}</title>
<meta name="description" content={description} />
<link rel="canonical" href={canonical} />

{noindex ? <meta name="robots" content="noindex, nofollow" /> : null}

<!-- Hreflang -->
<link rel="alternate" hreflang="de-CH" href={alternates.deCH} />
<link rel="alternate" hreflang="en" href={alternates.en} />
<link rel="alternate" hreflang="x-default" href={alternates.xDefault} />

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonical} />
<meta property="og:image" content={ogImage} />
<meta property="og:site_name" content="Recverse" />
<meta property="og:locale" content="de_CH" />
<meta property="og:locale:alternate" content="en_US" />

{publishedTime ? <meta property="article:published_time" content={publishedTime} /> : null}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImage} />

<!-- JSON-LD (Organization/LocalBusiness + Breadcrumbs) -->
<script type="application/ld+json" set:html={JSON.stringify(orgJsonLd)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbJsonLd)} />
